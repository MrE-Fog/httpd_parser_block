httpd_parser_block for phorum.study-area.org
============================================

This is apache log check in http://phorum.study-area.org.
This perl scipt can parser httpd log to found some malware activity, and parser ip to apache block file.


Check item:
1.Client request too many 4xx web.

TODO:
Check URL include /etc/passwd, and see other malware patten in PATTEN(file).

Run:
1. Create config file
	- vi config(create new) or `cp config-example config`, format see below.
2. Make sure you "apacheblockfile" location is correct in config.
2. Reset 
	- perl main.pl reset
3. Exec this perl script in crontab, and reload apache.
	- */5 * * * * perl main.pl /var/log/httpd/access_log && /etc/init.d/httpd reload
4. Reset everyday for clean block list.
	- 01 0 * * * perl main.pl reset

config file options: 
arraylimit:1000
	- Read 1000 line to check.
status4xxlimit:20
	- Limit of 4xx status in Read line, Block Rule.
apacheblockfile:/etc/httpd/conf.d/phorum-block.conf
	- Apache configure file location.
seek:23456
	- Save File seek, do NOT modify this line.

config file example:
arraylimit:10000
status4xxlimit:10
apacheblockfile:/etc/httpd/conf.d/phorum-block.conf


Output of Apache configure file:
==============================================================================================
#Do not edit this file, this is config by httpd_parser_block, you maybe found it in crontab.
<Directory /var/www/html/phorum.study-area.org>
	SetEnvIF X-Forwarded-For "(,| |^)1\.11\.22\.33 (,| |$)" DenyIP
	SetEnvIF X-Forwarded-For "(,| |^)55\.66\.77\.88 (,| |$)" DenyIP
	## insert rule ##
    Order allow,deny
    Deny from env=DenyIP
    Allow from all
</Directory>
==============================================================================================

Study-Area, Open Source Group in Taiwan
http://phorum.study-area.org
haway@study-area.org
